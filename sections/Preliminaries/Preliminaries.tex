\section{Preliminaries}
In this section we recall the necessariy work, including work from \cite{Guignard2018}, \cite{tendler2015geometricclassfieldtheory} and \cite{takeuchi2019blow}.

\subsection{Generalities}

\subsubsection{Equivalence between Torsors and Invertible Modules}
The following proposition establishes the fundamental dictionary between the geometric theory
of principal homogeneous spaces and the algebraic theory of invertible modules.
This equivalence allows us to transport the monoidal structure from the category of modules
(the tensor product) to the category of torsors (the contracted product),
strictly within the categorical framework.

\begin{prop}\label{prop:torsor_module_equivalence}
    Let $\mathcal{E}$ be a topos and let $\Lambda$ be a ring object in $\mathcal{E}$. Let $G = \Lambda^\times$ denote the internal group object of units of $\Lambda$.

    There is a canonical equivalence of monoidal categories between the category of $G$-torsors in $\mathcal{E}$ and the category of locally free $\Lambda$-modules of rank 1 in $\mathcal{E}$:
    \[
        \Phi: \mathbf{Tors}(\mathcal{E}, \Lambda^\times) \xrightarrow{\sim} \mathbf{Pic}(\mathcal{E}, \Lambda)
    \]
    The equivalence is defined by the associated module functor:
    \[
        P \longmapsto P \times^{\Lambda^\times} \Lambda := \Lambda^\times \backslash (\Lambda \times P)
    \]
    where the quotient is taken with respect to the diagonal action of $\Lambda^\times$ on $\Lambda \times P$. The inverse functor associates to an invertible module $L$ its sheaf of basis frames $\underline{\mathrm{Isom}}_\Lambda(\Lambda, L)$.
\end{prop}

In light of this canonical equivalence, we will pass freely between the language of $G$-torsors and that of locally free $\Lambda$-modules throughout the text.

For a topos $\cE$, a group object $G$ in $\cE$ and an object $X$ in $\cE$, there is a canonical identification
between $({G\cE})_{/X}$ and $G(\cE_{/X})$, given by endowing $X$ with the trivial $G$-action.

We denote by $\mathbf{Tors}(X, G)$ the category of $G$-torsors over $X$ in $G \cE_{/X}$.
Similarly, for a ring object $\Lambda$ in $\cE$, we denote by $\mathbf{Pic}(X, \Lambda)$ the category of locally free $\Lambda$-modules of rank 1 over $X$ in $\cE_{/X}$.
The above equivilance of categories becomes 
\[
    \Phi_X: \mathbf{Tors}(X, \Lambda^\times) \xrightarrow{\sim} \mathbf{Pic}(X, \Lambda)
\].



\subsubsection{Symmetric Powers of Schemes and Sheaves}

There are several important theorems that repeat themselves throughout deligne approach to class field theory,
one of them, is that the symmetric power of $C$ over $k$, denoted by $C^{(d)}$, is a scheme over $k$,
Guigard proves this in the most general setting so we qoute his result here:
\begin{prop}
    If $X$ is Zariski locally quasi-projective over a scheme $S$, the the right action of $S_d$ on $X^{\times_S d}$ 
    is admissible, and the quotient $X^{(d)} = X^{\times_S d}/S_d$ exists as a scheme over $S$.
\end{prop}

\subsubsection{Etale Fundamental Groups}
fff

\subsection{Generalized Picard Scheme}
In this section, we recall the notion of generalized Jacobian varieties and study their fundamental properties. The material presented here is primarily adapted from \cite{Guignard2018} and \cite{takeuchi2019blow}. For further background on the general theory of abelian varieties and Jacobians, the reader may also consult \cite{milneAV}.
Let $S$ be a scheme and let $C$ be a projective smooth $S$-scheme whose geometric fibers are connected and of dimension 1. Let $\mdls$ be a modulus on $C$, defined as an effective Cartier divisor of $C/S$ 
(i.e., a closed subscheme of $C$ which is finite flat of finite presentation over $S$).
We denote the projection $C \times_S T \to T$ by $\text{pr}$ for any $S$-scheme $T$.

\subsubsection*{The Functor of Points}
Let $d$ be an integer. For an $S$-scheme $T$, we consider the set of data $(\cL, \psi)$ where:
\begin{itemize}
    \item $\cL$ is an invertible sheaf of degree $d$ on $C_T$.
    \item $\psi: \Oo_{\mdls_T} \xrightarrow{\sim} \cL|_{\mdls_T}$ is a trivialization of $\cL$ along the modulus.
\end{itemize}
Two such pairs $(\cL, \psi)$ and $(\cL', \psi')$ are said to be isomorphic if there exists an isomorphism of invertible sheaves $f : \cL \to \cL'$ such that the following diagram commutes:
\[
\begin{tikzcd}
& \Oo_{\mdls_T} \arrow[dl, "\psi'"'] \arrow[dr, "\psi"] & \\
\cL'|_{\mdls_T} \arrow[rr, "f|_{\mdls_T}"] & & \cL|_{\mdls_T}
\end{tikzcd}
\]
We define the presheaf $\text{Pic}_{C, \mdls}^{d, \text{pre}}$ on $\text{Sch}/S$ by assigning to $T$ the set of isomorphism classes of such pairs. Let $\PicCm[d]$ denote the \'etale sheafification of this presheaf.

\subsubsection*{Representability and Structure}
The fundamental properties of this functor are as follows:
\begin{enumerate}
    \item $\text{Pic}_{C, \mdls}^{d}$ is represented by an $S$-scheme. (Note: If $\mdls$ is faithfully flat over $S$, the presheaf is already an \'etale sheaf).
    \item $\text{Pic}_{C, \mdls}^{0}$ is a smooth commutative group $S$-scheme with geometrically connected fibers, referred to as the \textit{generalized Jacobian variety} of $C$ with modulus $\mdls$.
    \item For any $d$, $\text{Pic}_{C, \mdls}^{d}$ is a $\text{Pic}_{C, \mdls}^{0}$-torsor.
\end{enumerate}
In the case where $\mdls = 0$, we recover the standard Jacobian variety, denoted simply as $\text{Pic}_C^d$.
\subsubsection*{Relation to the Standard Jacobian}
We now examine the behavior of the generalized Picard scheme under the variation of the modulus. By viewing the structure along the modulus as an additional rigidification, we obtain natural transition maps corresponding to the inclusion of moduli.

Let $\mdls_1$ and $\mdls_2$ be moduli such that $\mdls_1 \subset \mdls_2$. There exists a natural map 
\[
\text{Pic}_{C, \mdls_2}^d \to \text{Pic}_{C, \mdls_1}^d
\]
obtained by restricting the isomorphism $\psi$. Since $\mdls_2$ is a finite $S$-scheme, this map is a surjection as a morphism of \'etale sheaves.
In particular, for any modulus $\mdls$, there is a natural surjective morphism of \'etale sheaves:
\[
\text{Pic}_{C, \mdls}^d \to \text{Pic}_C^d.
\]


\subsubsection*{Local Freeness and Base Change}
From this point forward, we fix a modulus $\mdls$ which is everywhere strictly positive. Let $g$ denote the genus of $C$, which is a locally constant function on $S$. We restrict our attention to degrees $d$ satisfying the condition:
\begin{equation} \label{equation:degree-condition}
    d \geq \max\{2g - 1 + \deg \mdls, \deg \mdls\}.
\end{equation}
Assuming $S$ is quasi-compact, such a $d$ always exists.

Fix an integer $d$ satisfying the condition above. Let $T$ be an $S$-scheme and let $\cL$ be an invertible sheaf of degree $d$ on $C_T$. One can show that the pushforwards $\mathrm{pr}_* \cL$ and $\mathrm{pr}_* \cL(-\tilde{\mdls})$ are locally free sheaves and their formations commute with any base change. Explicitly, for any morphism of $S$-schemes $f : T' \to T$, the base change morphisms are isomorphisms:
\[
    f^* \mathrm{pr}_* \cL \xrightarrow{\sim} \mathrm{pr}_* f^* \cL
\]
and
\[
    f^* \mathrm{pr}_* (\cL(-\tilde{\mdls})) \xrightarrow{\sim} \mathrm{pr}_* f^* (\cL(-\tilde{\mdls})).
\]
In particular, following \cite{Guignard2018}, if $\cL$ is invertible $\cO_C$-module with degree $d$ on each fiber of $f$ then, $\mathrm{pr}_* \cL$ is a locally free $\mathcal{O}_S$-module of rank $d-g+1$.

For further background and verification of these constructions, we refer the reader to Milne's notes on Abelian Varieties (\cite{milneAV}).

\subsection{The Abel-Jacobi Morphism and its Fibers}


Let $U = C \setminus \mdls$ be the complement of the modulus in $C$.
The effective cartier divisors of degree $d$ which are prime to $\mdls$ are parameterized by the symmetric power $\Sym_S^d (U) = U^{(d)}$ over $S$ (See \cite{Guignard2018} Proposition 4.12, \cite{milneAV} Theorem 3.13).
For any such divisor $D \in U^{(d)}$, the associated line bundle $\Oo_C(D)$ admits a canonical trivialization along $\mdls$. 
Specifically, the canonical section $1_D$ is regular and non-vanishing on $\mdls$ because $\operatorname{supp}(D) \cap \operatorname{supp}(\mdls) = \emptyset$. 
This section restricts to a nowhere-vanishing section on the subscheme $\mathfrak{m}$, thereby determining a trivialization $\psi_D^{-1}: \Oo_C(D)|_{\mdls} \xrightarrow{\sim} \Oo_{\mdls}$.
This is done functorially in families, yielding a morphism from the symmetric power to the generalized Picard scheme (over $S$):
\begin{equation}
    \Phi_{d}: U^{(d)} \to \Pic^d_{C, \mathfrak{m}}, \quad D \mapsto [(\mathcal{O}_C(D), \psi_D)],
\end{equation}

When $\mdls = 0$, and $C$ admits a section over $S$, $C^{(d)}$ is a projective space bundle over $\PicC[d]$ 
when $d \geq max \{2g - 1, 0\}$, Guignard (\cite{Guignard2018} Theorem 4.14) proves that for $\mdls > 0$ and $d$ satisfying \cref{equation:degree-condition}, the Abel-Jacobi morphism $\Phi_d$ is 
surjective smooth of relative dimension $d - \deg \mdls - g + 1$, with geometrically connected fibers. 

When $S=\spec (k^{sep})$, the fibers of $\Phi_d$ are well understood:
\begin{theorem}
    Assuming $S=\spec (k^{sep})$, $d \geq max \{2g - 1 + \deg \mdls, \deg \mdls\}$. Then, the fibers of the Abel-Jacobi morphism $$ \Phi_d : U^{(d)} \to \PicCm[d] $$ over any point are isomorphic to
$$
\begin{cases}
\mathbb{A}_k^{d - \deg \mdls - g + 1} & \text{if } m > 0 \\
\mathbb{P}_k^{d - g} & \text{if } m = 0
\end{cases}
$$
In both cases $\Phi_d$ is a fibration in affine spaces or projective spaces, depending on whether $\mdls$ is non-zero or zero.
\end{theorem}
\begin{proof}
see \cite{tendler2015geometricclassfieldtheory} Propositions 3.13-3.14, \cite{Toth2011} Prop 2.1.4:    


\end{proof}



\subsection{Symmetric Powers}
\input{sections/Preliminaries/SymmetricPowers.tex}

\subsection{Kummer Theory}
\input{sections/Preliminaries/KummerTheory.tex}

\subsection{\texorpdfstring{The equivalence between $G$-torsors and locally free $\Lambda$-modules}{The equivalence between G-torsors and locally free Lambda-modules}}
\input{sections/Preliminaries/TorsorsAndLocalSystems.tex}

\subsection{Ramification after Blowup}
\input{sections/Preliminaries/Blowup.tex}
